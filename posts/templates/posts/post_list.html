{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>–í—Å–µ –ø–æ—Å—Ç—ã</h1>
        {% if user.is_authenticated %}
        <a href="{% url 'create_post' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a>
        {% endif %}
    </div>
    
    {% for post in posts %}
    <div class="post" data-post-id="{{ post.id }}">
        <div class="post-content">
            <div class="vote-section">
                {% if user.is_authenticated %}
                <button class="vote-btn upvote-btn" data-vote-type="upvote" aria-label="–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞">
                    ‚ñ≤
                </button>
                {% endif %}
                <div class="vote-count" id="post-score-{{ post.id }}">{{ post.score }}</div>
                {% if user.is_authenticated %}
                <button class="vote-btn downvote-btn" data-vote-type="downvote" aria-label="–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤">
                    ‚ñº
                </button>
                {% endif %}
            </div>
            <div class="post-body">
                <div class="post-header">
                    –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {{ post.author.username }} ‚Ä¢ {{ post.created_at|timesince }} –Ω–∞–∑–∞–¥
                    {% if post.community %}
                    –≤ <a href="{% url 'communities:community_detail' post.community.name %}">r/{{ post.community.name }}</a>
                    {% endif %}
                </div>
                <h2 class="post-title">
                    <a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a>
                </h2>
                <div class="post-text">
                    {{ post.content|truncatewords:30 }}
                </div>
                <div class="post-actions">
                    <a href="{% url 'post_detail' post.pk %}" class="action-btn">
                        <i>üí¨</i> {{ post.comments.count }} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                    </a>
                    <button class="action-btn share-btn">
                        <i>‚ÜóÔ∏è</i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="text-center">
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤.</p>
        {% if user.is_authenticated %}
        <a href="{% url 'create_post' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç</a>
        {% else %}
        <a href="{% url 'login' %}" class="btn btn-primary">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/voting.js' %}"></script>
{% endblock %}